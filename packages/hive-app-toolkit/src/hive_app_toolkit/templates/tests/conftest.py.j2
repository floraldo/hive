"""Pytest configuration and fixtures for {{ app_name }}."""

from __future__ import annotations

import pytest
{% if service_type == 'api' or service_type == 'webhook' %}
from fastapi.testclient import TestClient

from {{ app_module }}.api.main import create_app
from {{ app_module }}.config import {{ app_module | class_name }}Config


@pytest.fixture
def test_config() -> {{ app_module | class_name }}Config:
    """Create test configuration."""
    return {{ app_module | class_name }}Config(
        environment="test",
        {% if needs_database or enable_database -%}
        database_path=":memory:",  # In-memory database for tests
        {% endif -%}
        {% if needs_cache or enable_cache -%}
        cache_enabled=False,  # Disable cache for tests
        {% endif -%}
    )


@pytest.fixture
def test_app(test_config: {{ app_module | class_name }}Config) -> TestClient:
    """Create test FastAPI client."""
    app = create_app(test_config)
    return TestClient(app)
{% else %}
from {{ app_module }}.config import {{ app_module | class_name }}Config


@pytest.fixture
def test_config() -> {{ app_module | class_name }}Config:
    """Create test configuration."""
    return {{ app_module | class_name }}Config(
        environment="test",
        {% if needs_database or enable_database -%}
        database_path=":memory:",  # In-memory database for tests
        {% endif -%}
        {% if needs_cache or enable_cache -%}
        cache_enabled=False,  # Disable cache for tests
        {% endif -%}
    )
{% endif %}
